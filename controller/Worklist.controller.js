sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment"],function(e,o,t,n,s,i){"use strict";var a;var c;var r="/colsubsidio-app/";var l;return e.extend("com.colsubsidio.syncpanel.syncpanel.controller.Worklist",{formatter:t,onEvent:function(e){var o=e.getSource().getBindingContext().getObject();a.onSelectService(o,e.getSource())},onSelectService:function(e,t){console.log(e);console.log(t);var n=new o({selectedEpsKey:""});if(e["param"]){var s=this.getView();if(!this.byId("ParamDialog")){i.load({id:s.getId(),name:"com.colsubsidio.syncpanel.syncpanel.view.Dialog.ParamDialog",controller:a}).then(function(o){s.addDependent(o);o.open();o.setModel(n);a._oDialog=o;a.onCreateContent(e,o)})}else{this.byId("ParamDialog").open();a.onCreateContent(e,this.byId("ParamDialog"))}}else{a.onSendService(e,t,"")}},onSendService:function(e,o,t,n){console.log(r+e.url+t);$.ajax({method:"GET",url:r+e.url+t,beforeSend:function(){o.setBusy(true)},success:function(e){o.setBusy(false);sap.m.MessageToast.show("Datos Sincronizados correctamente.");if(n){o.close()}},error:function(){o.setBusy(false);o.setInfoState(sap.ui.core.ValueState.Error)}})},onCreateContent:function(e,t){var n=a.getView().byId("feObjects").destroyFormElements();var s;var i={};var c={};$.each(e.param,function(e,o){i={};i["grupo"+e]=[];$.each(o.grupo,function(o,t){i=a.onCreateObject(t,i,e)});s=null;s=new sap.ui.layout.form.FormElement({label:i.l.text,fields:[i.o]});n.addFormElement(s);c["grupo"+e]=i["grupo"+e]});t.setModel(new o(c));t.setModel(new o(e),"info")},onSync:function(){var e=this.byId("ParamDialog");var o=e.getModel("info").getData();var t="";var n=e.getModel().getData();var s;$.each(n,function(e,o){console.log(o);console.log(e);$.each(o,function(e,o){s="";if(o.type==="c"){s=sap.ui.getCore().byId(o.id).getSelectedKey();if(s===""){sap.m.MessageToast.show("Campo vacio");return}else{if(o.pos!==0){t=t+"/"+s}else{t=t+s}}}else if(o.type==="i"){console.log(o.id);s=sap.ui.getCore().byId(o.id).getValue();if(s===""){sap.m.MessageToast.show("Campo vacio");return}else{if(o.pos!==0){t=t+"/"+s}else{t=t+s}}}})});console.log(t);a.onSendService(o,e,t,true)},onCreateObject:function(e,o,t){if(e.type==="l"){o.l={text:e.text}}else if(e.type==="o"){if(e.subType==="i"){o.o=new sap.m.Input("grupo-"+t+e.subType,{placeholder:""});o["grupo"+t].push({type:"i",id:"grupo-"+t+e.subType,pos:t})}else if(e.subType==="c"){var n=new sap.m.ComboBox("grupo-"+t+e.subType,{placeholder:"Seleccione EPS"});var s=new sap.ui.core.Item({text:"{EpsDescripcion}",key:"{EpsCodigo}"});n.setModel(l);n.bindItems("/results",s);o.o=n;o["grupo"+t].push({type:"c",id:"grupo-"+t+e.subType,pos:t})}}return o},onGoPaymentboxSync:function(){this.getRouter().navTo("paymentboxSync")},onInit:function(){a=this;c=a.getOwnerComponent().getModel();c.read("/Epss",{success:function(e,t){l=new o(e)}});var e={TileCollection:[{icon:"sap-icon://offsite-work",title:"Causales Externos",info:"Habilitado",method:1,url:"dispensacion/sync/causalesExterno",infoState:"Success"},{icon:"sap-icon://database",title:"Constantes ERP",info:"Habilitado",method:2,url:"dispensacion/sync/constantesErp",infoState:"Success"},{icon:"sap-icon://decision",title:"Contratos Marco",info:"Habilitado",method:3,url:"dispensacion/sync/contratosMarco",infoState:"Success"},{icon:"sap-icon://decision",title:"Convenios Centro / IPS",info:"Habilitado",method:4,url:"dispensacion/sync/conveniosCentroIps",infoState:"Success"},{icon:"sap-icon://database",title:"Conversores EPS",info:"Habilitado",method:5,url:"dispensacion/sync/conversoresEps",infoState:"Success"},{icon:"sap-icon://database",title:"Cuotas Moderadoras EPS",info:"Habilitado",url:"dispensacion/sync/cuotasModeradora/",param:[{grupo:[{type:"l",text:"EPS",wrapping:true},{type:"o",subType:"c",source:"/Epss",selectedKey:"{selectedEpsKey}"}]}],infoState:"Success"},{icon:"sap-icon://database",title:"Carga EPS´s",info:"Habilitado",url:"dispensacion/sync/dataAll/",param:[{grupo:[{type:"l",text:"EPS",wrapping:true},{type:"o",subType:"c",source:"/Eps",selectedKey:"{selectedEpsKey}"}]}],infoState:"Success"},{icon:"sap-icon://database",title:"EPS / IPS",info:"Habilitado",infoState:"Success",url:"dispensacion/sync/epsIps"},{icon:"sap-icon://accidental-leave",title:"Farmacias",info:"Habilitado",infoState:"Success",url:"dispensacion/sync/farmacias"},{icon:"sap-icon://database",title:"IPS / Convenio",info:"Habilitado",infoState:"Success",url:"dispensacion/sync/ips/",param:[{grupo:[{type:"l",text:"Convenio",wrapping:true},{type:"o",subType:"i"}]}]},{icon:"sap-icon://database",title:"Medicamentos EPS / Convenio",info:"Habilitado",infoState:"Success",url:"dispensacion/sync/medicamentos/",param:[{grupo:[{type:"l",text:"EPS",wrapping:true},{type:"o",subType:"c",source:"/Eps",selectedKey:"{selectedKey}"}]},{grupo:[{type:"l",text:"Convenio",wrapping:true},{type:"o",subType:"i"}]}]},{icon:"sap-icon://product",title:"Medicamentos Stock",info:"Habilitado",infoState:"Success",enabled:true},{icon:"sap-icon://database",title:"Motivos Pendiente",info:"Habilitado",url:"dispensacion/sync/motivosPendiente",infoState:"Success"},{icon:"sap-icon://customer-order-entry",title:"Sincronizar Pedido",info:"Habilitado",url:"dispensacion/sync/pedido/",param:[{grupo:[{type:"l",text:"N° Pedido",wrapping:true},{type:"o",subType:"i"}]}],infoState:"Success"},{icon:"sap-icon://customize",title:"Tablas Maestras",info:"Habilitado",url:"dispensacion/sync/tablasMaestras",infoState:"Success"},{icon:"sap-icon://database",title:"Topes Moléculas",info:"Habilitado",url:"dispensacion/sync/topesMolecula",infoState:"Success"}]};var t=new o(e);this.getView().setModel(t)},onUpdateFinished:function(e){},onPress:function(e){},onShareInJamPress:function(){},onSearch:function(e){},onRefresh:function(){},_showObject:function(e){},_applySearch:function(e){}})});